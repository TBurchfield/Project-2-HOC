{"version":3,"sources":["scene.js"],"names":["camera","scene","renderer","controls","objects","raycaster","blocker","document","getElementById","instructions","sign","x","NaN","range_scale","in_min","in_max","out_min","out_max","havePointerLock","element","body","pointerlockchange","event","pointerLockElement","mozPointerLockElement","webkitPointerLockElement","controlsEnabled","enabled","style","display","pointerlockerror","addEventListener","requestPointerLock","mozRequestPointerLock","webkitRequestPointerLock","innerHTML","moveForward","moveBackward","moveLeft","moveRight","canJump","prevTime","performance","now","prevAngle","velocity","THREE","Vector3","direction","vertex","color","Color","init","animate","PerspectiveCamera","window","innerWidth","innerHeight","Scene","background","fog","Fog","light","HemisphereLight","position","set","add","PointerLockControls","getObject","onKeyDown","keyCode","y","onKeyUp","Raycaster","floorGeometry","PlaneBufferGeometry","rotateX","Math","PI","attributes","i","count","fromBufferAttribute","random","z","setXYZ","toNonIndexed","colors","setHSL","push","r","g","b","addAttribute","Float32BufferAttribute","floorMaterial","MeshBasicMaterial","vertexColors","VertexColors","floor","Mesh","boxGeometry","BoxBufferGeometry","boxMaterial","MeshPhongMaterial","specular","flatShading","box","WebGLRenderer","antialias","setPixelRatio","devicePixelRatio","setSize","appendChild","domElement","onWindowResize","aspect","updateProjectionMatrix","requestAnimationFrame","ray","origin","copy","intersections","intersectObjects","onObject","length","time","delta","getWorldDirection","angle","radToDeg","atan","radians","degToRad","df","Number","normalize","dt","sin","cos","max","translateX","translateY","translateZ","render"],"mappings":"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","file":"scene.156cb9e1.map","sourceRoot":"..","sourcesContent":["var camera, scene, renderer, controls;\n\nvar objects = [];\n\nvar raycaster;\n\nvar blocker = document.getElementById( 'blocker' );\nvar instructions = document.getElementById( 'instructions' );\n\n// http://www.html5rocks.com/en/tutorials/pointerlock/intro/\n\nfunction sign(x) {\n    return typeof x === 'number' ? x ? x < 0 ? -1 : 1 : x === x ? 0 : NaN : NaN;\n}\n\nfunction range_scale(x, in_min, in_max, out_min, out_max) {\n  return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;\n}\n\nvar havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;\n\nif ( havePointerLock ) {\n\n  var element = document.body;\n\n  var pointerlockchange = function ( event ) {\n\n      if ( document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element ) {\n\n          controlsEnabled = true;\n          controls.enabled = true;\n\n          blocker.style.display = 'none';\n\n      } else {\n\n          controls.enabled = false;\n\n          blocker.style.display = 'block';\n\n          instructions.style.display = '';\n\n      }\n\n  };\n\n  var pointerlockerror = function ( event ) {\n\n      instructions.style.display = '';\n\n  };\n\n  // Hook pointer lock state change events\n  document.addEventListener( 'pointerlockchange', pointerlockchange, false );\n  document.addEventListener( 'mozpointerlockchange', pointerlockchange, false );\n  document.addEventListener( 'webkitpointerlockchange', pointerlockchange, false );\n\n  document.addEventListener( 'pointerlockerror', pointerlockerror, false );\n  document.addEventListener( 'mozpointerlockerror', pointerlockerror, false );\n  document.addEventListener( 'webkitpointerlockerror', pointerlockerror, false );\n\n  instructions.addEventListener( 'click', function ( event ) {\n\n      instructions.style.display = 'none';\n\n      // Ask the browser to lock the pointer\n      element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;\n      element.requestPointerLock();\n\n  }, false );\n\n} else {\n\n  instructions.innerHTML = 'Your browser doesn\\'t seem to support Pointer Lock API';\n\n}\n\nvar controlsEnabled = false;\n\nvar moveForward = false;\nvar moveBackward = false;\nvar moveLeft = false;\nvar moveRight = false;\nvar canJump = false;\n\nvar prevTime = performance.now();\nvar prevAngle = 0;\nvar velocity = new THREE.Vector3();\nvar direction = new THREE.Vector3();\nvar vertex = new THREE.Vector3();\nvar color = new THREE.Color();\n\ninit();\nanimate();\n\nfunction init() {\n\n  camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1000\n);\n\n  scene = new THREE.Scene();\n  scene.background = new THREE.Color( 0xffffff );\n  scene.fog = new THREE.Fog( 0xffffff, 0, 750 );\n\n  var light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 );\n  light.position.set( 0.5, 1, 0.75 );\n  scene.add( light );\n\n  controls = new THREE.PointerLockControls( camera, scene );\n  scene.add( controls.getObject() );\n\n  var onKeyDown = function ( event ) {\n\n      switch ( event.keyCode ) {\n\n          case 38: // up\n          case 87: // w\n              moveForward = true;\n              break;\n\n          case 37: // left\n          case 65: // a\n              moveLeft = true; break;\n\n          case 40: // down\n          case 83: // s\n              moveBackward = true;\n              break;\n\n          case 39: // right\n          case 68: // d\n              moveRight = true;\n              break;\n\n          case 32: // space\n              if ( canJump === true ) velocity.y += 350;\n              canJump = false;\n              break;\n\n      }\n\n  };\n\n  var onKeyUp = function ( event ) {\n\n      switch( event.keyCode ) {\n\n          case 38: // up\n          case 87: // w\n              moveForward = false;\n              break;\n\n          case 37: // left\n          case 65: // a\n              moveLeft = false;\n              break;\n\n          case 40: // down\n          case 83: // s\n              moveBackward = false;\n              break;\n\n          case 39: // right\n          case 68: // d\n              moveRight = false;\n              break;\n\n      }\n\n  };\n\n  document.addEventListener( 'keydown', onKeyDown, false );\n  document.addEventListener( 'keyup', onKeyUp, false );\n\n  raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 );\n\n  // floor\n  var floorGeometry = new THREE.PlaneBufferGeometry( 2000, 2000, 100, 100 );\n  floorGeometry.rotateX( - Math.PI / 2 );\n\n  // vertex displacement\n  var position = floorGeometry.attributes.position;\n\n  for ( var i = 0; i < position.count; i ++ ) {\n\n      vertex.fromBufferAttribute( position, i );\n\n      vertex.x += Math.random() * 20 - 10;\n      vertex.y += Math.random() * 2;\n      vertex.z += Math.random() * 20 - 10;\n\n      position.setXYZ( i, vertex.x, vertex.y, vertex.z );\n\n  }\n\n  floorGeometry = floorGeometry.toNonIndexed(); // ensure each face has unique vertices\n\n  count = floorGeometry.attributes.position.count;\n  var colors = [];\n\n  for ( var i = 0; i < count; i ++ ) {\n\n      color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 );\n      colors.push( color.r, color.g, color.b );\n\n  }\n\n  floorGeometry.addAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );\n\n  var floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: THREE.VertexColors } );\n\n  var floor = new THREE.Mesh( floorGeometry, floorMaterial );\n  scene.add( floor );\n\n  // objects\n\n  var boxGeometry = new THREE.BoxBufferGeometry( 20, 20, 20 );\n  boxGeometry = boxGeometry.toNonIndexed(); // ensure each face has unique vertices\n\n  count = boxGeometry.attributes.position.count;\n  colors = [];\n\n  for ( var i = 0; i < count; i ++ ) {\n\n      color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 );\n      colors.push( color.r, color.g, color.b );\n\n  }\n\n  boxGeometry.addAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );\n\n  for ( var i = 0; i < 500; i ++ ) {\n\n      var boxMaterial = new THREE.MeshPhongMaterial( { specular: 0xffffff, flatShading: true, vertexColors: THREE.VertexColors } );\n      boxMaterial.color.setHSL( Math.random() * 0.2 + 0.5, 0.75, Math.random() * 0.25 + 0.75 );\n\n      var box = new THREE.Mesh( boxGeometry, boxMaterial );\n      box.position.x = Math.floor( Math.random() * 20 - 10 ) * 20;\n      box.position.y = Math.floor( Math.random() * 20 ) * 20 + 10;\n      box.position.z = Math.floor( Math.random() * 20 - 10 ) * 20;\n\n      scene.add( box );\n      objects.push( box );\n\n  }\n\n  renderer = new THREE.WebGLRenderer( { antialias: true } );\n  renderer.setPixelRatio( window.devicePixelRatio );\n  renderer.setSize( window.innerWidth, window.innerHeight );\n  document.body.appendChild( renderer.domElement );\n\n  window.addEventListener( 'resize', onWindowResize, false );\n}\n\nfunction onWindowResize() {\n\n  camera.aspect = window.innerWidth / window.innerHeight;\n  camera.updateProjectionMatrix();\n\n  renderer.setSize( window.innerWidth, window.innerHeight );\n\n}\n\nfunction animate() {\n\n\trequestAnimationFrame( animate );\n\n\tif ( controlsEnabled === true ) {\n\n\t\traycaster.ray.origin.copy( controls.getObject().position );\n\t\traycaster.ray.origin.y -= 10;\n\n\t\tvar intersections = raycaster.intersectObjects( objects );\n\n\t\tvar onObject = intersections.length > 0;\n\n\t\tvar time = performance.now();\n\t\tvar delta = ( time - prevTime ) / 1000;\n\n\t\tvelocity.x -= velocity.x * 5.0 * delta;\n    velocity.y -= velocity.y * 5.0 * delta;\n\t\tvelocity.z -= velocity.z * 5.0 * delta;\n\n    direction = camera.getWorldDirection( direction );\n    angle = THREE.Math.radToDeg( Math.atan(direction.y) )\n    angle = range_scale(angle, -45, 45, -90, 90)\n    let radians = THREE.Math.degToRad(angle)\n\n\t\tdf = sign(direction.z)\n\t\tdirection.x = Number( moveLeft ) - Number( moveRight );\n\t\tdirection.normalize(); // this ensures consistent movements in all directions\n\n\t\tif ( moveForward || moveBackward ) {\n      let dt = moveForward ? 1 : -1\n\n      direction.y = df * Math.sin(radians)\n      direction.z = df * Math.cos(radians)\n\n      velocity.y -= -df * dt * direction.y * 800.0 * delta;\n      velocity.z -= df * dt * direction.z * 800.0 * delta;\n    }\n\n\t\tif ( moveLeft || moveRight ) {\n      velocity.x -= direction.x * 1000.0 * delta;\n    }\n\n\t\tif ( onObject === true ) {\n\t\t\tvelocity.y = Math.max( 0, velocity.y );\n\t\t\tcanJump = true;\n\t\t}\n\n\t\tcontrols.getObject().translateX( velocity.x * delta );\n\t\tcontrols.getObject().translateY( velocity.y * delta );\n\t\tcontrols.getObject().translateZ( velocity.z * delta );\n\n\t\t// if ( controls.getObject().position.y < 10 ) {\n    //\n\t\t// \tvelocity.y = 0;\n\t\t// \tcontrols.getObject().position.y = 10;\n    //\n\t\t// \tcanJump = true;\n    //\n\t\t// }\n\n\t\tprevTime = time;\n\n\t}\n\trenderer.render( scene, camera );\n}\n"]}